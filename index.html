<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            let but = document.getElementById("but");
            let video = document.getElementById("vid");
            let mediaDevices = navigator.mediaDevices;
            const scanButton = document.getElementById('scanButton');
            let barcodeScanner;
            const scannedBarcode;
            vid.muted = true;
            but.addEventListener("click", () => {
                // if(video==false){
                //         video=true;
                //         // video.stop();
                //     }else{video=false
                //     video.stop()}
    
                // Accessing the user camera and video.
                mediaDevices
                    .getUserMedia({
                        video: true,
                        audio:false,
                    })
                    .then((stream) => {
    
                        // Changing the source of video to current stream.
                        video.srcObject = stream;
                        video.addEventListener("loadedmetadata", () => {
                            video.play();
                        });
                        barcodeScanner = new BarcodeDetector();
                    })
                    .catch(alert);


            });
            scanButton.addEventListener('click', async () => {
            try {
            const barcodes = await barcodeScanner.detect(video);

            if (barcodes.length > 0) {
                 scannedBarcode = barcodes[0].rawValue;
                alert(`Scanned Barcode: ${scannedBarcode}`);
                sendDataToServer(scannedBarcode);
            } else {
                alert('No barcode detected');
            }
        } catch (error) {q
            console.error('Barcode scanning error:', error);
        }
    });
        function sendDataToServer(barcodeValue){
            fetch('/barcode',{
                method:'POST',
                headers:{
                    'Content-Type': 'application/json',
                },
                body:JSON.stringify({ barcode: barcodeValue }),
            })
        }
        });
    </script>
    <style>
        div {
            width: 500px;
            height: 400px;
            border: 2px solid black;
            position: relative;
        }
    
        video {
            width: 500px;
            height: 400px;
            object-fit: cover;
        }
    </style>
    <div>
        <video id="vid"></video>
    </div>
    <br />
    <button id="but" autoplay>
        Open WebCam
    </button>

    <button id="scanButton">
        Scan
    </button>
    
</body>
</html>